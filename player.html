<!DOCTYPE html>
<html lang="en">
<head>
    <title>Watch Now - Unruly Movies | Luganda VJ Translations</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Watch Luganda translated movies on Unruly Movies - A legitimate Ugandan entertainment platform developed by Nduga Hafizu featuring licensed VJs.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#7CFC00">
    <meta name="author" content="Nduga Hafizu">
    <meta name="robots" content="noindex">
    <meta name="google-adsense-account" content="ca-pub-1904736753681797">
    
    <!-- Open Graph / Social Share Meta -->
    <meta property="og:type" content="video.movie">
    <meta property="og:site_name" content="Unruly Movies">
    <meta property="og:title" content="Watch Now - Unruly Movies">
    <meta property="og:description" content="Watch Luganda translated movies on Unruly Movies - Legitimate Ugandan platform by Nduga Hafizu">
    <meta property="og:image" content="">
    <meta property="og:url" content="">
    
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/images/favicon.png">
    <link rel="shortcut icon" type="image/png" href="/assets/images/favicon.png">
    <link rel="apple-touch-icon" href="/assets/images/logo.png">
    <link rel="apple-touch-icon" href="assets/images/icons/icon-192x192.png">
    <link rel="manifest" href="manifest.json">
    
    <!-- Plyr CSS - Legal open-source player -->
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">
    
    <!-- Main Styles -->
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1904736753681797" crossorigin="anonymous"></script>
    
    <style>
        /* Player Page Responsive Styles */
        :root {
            --player-radius: 12px;
            --primary-color: #7CFC00;
            --background-dark: #0a0a0a;
            --background-light: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #888888;
            --border-color: #333333;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background-dark);
            color: var(--text-primary);
            line-height: 1.5;
            min-height: 100vh;
        }
        
        /* Header */
        .player-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            background: linear-gradient(to bottom, rgba(0,0,0,0.95), transparent);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.3s ease;
        }
        
        .player-header.hidden {
            transform: translateY(-100%);
        }
        
        .back-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #fff;
            text-decoration: none;
            font-weight: 500;
            padding: 10px 15px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .back-btn:hover {
            background: rgba(124, 252, 0, 0.2);
            color: var(--primary-color);
        }
        
        .header-logo {
            height: 35px;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .header-btn:hover {
            background: var(--primary-color);
            color: #000;
        }
        
        /* Main Player Container */
        .player-wrapper {
            position: relative;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background: #000;
            padding-top: 60px;
        }
        
        /* Plyr Customization */
        .plyr {
            --plyr-color-main: #7CFC00;
            --plyr-video-background: #000;
            --plyr-menu-background: rgba(26, 26, 26, 0.95);
            --plyr-menu-color: #fff;
            --plyr-menu-border-color: #333;
        }
        
        /* Embed Container Styles */
        #embedContainer {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: #000;
            border-radius: var(--player-radius);
            overflow: hidden;
        }
        
        #embedContainer iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }
        
        @media (max-width: 767px) {
            #embedContainer {
                border-radius: 0;
            }
        }
        
        .plyr--full-ui input[type=range] {
            color: var(--plyr-color-main);
        }
        
        .plyr__control--overlaid {
            background: rgba(124, 252, 0, 0.9);
            color: #000;
        }
        
        .plyr__control--overlaid:hover {
            background: #7CFC00;
        }
        
        .plyr__controls {
            background: linear-gradient(transparent, rgba(0,0,0,0.9));
            padding: 20px 15px 15px;
        }
        
        /* Content Section */
        .content-wrapper {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Movie Info Card */
        .movie-info-card {
            background: var(--background-light);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .movie-header {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .movie-poster-small {
            width: 120px;
            height: 180px;
            border-radius: 12px;
            object-fit: cover;
            flex-shrink: 0;
            display: none;
        }
        
        .movie-details {
            flex: 1;
            min-width: 0;
        }
        
        .movie-title {
            font-size: clamp(20px, 5vw, 32px);
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.2;
        }
        
        .movie-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .meta-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .meta-badge.quality {
            background: var(--primary-color);
            color: #000;
            font-weight: 600;
        }
        
        .meta-badge.rating {
            background: rgba(255, 215, 0, 0.2);
            color: #FFD700;
        }
        
        .meta-badge svg {
            width: 14px;
            height: 14px;
        }
        
        .vj-info {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(124, 252, 0, 0.1);
            border: 1px solid rgba(124, 252, 0, 0.3);
            border-radius: 12px;
            margin-bottom: 15px;
        }
        
        .vj-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            object-fit: cover;
        }
        
        .vj-details {
            flex: 1;
        }
        
        .vj-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .vj-name {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .movie-description {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }
        
        .movie-description.collapsed {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .show-more-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 13px;
            padding: 0;
            margin-bottom: 15px;
        }
        
        /* Action Buttons */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .action-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            text-decoration: none;
        }
        
        .action-btn svg {
            width: 18px;
            height: 18px;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: #000;
        }
        
        .btn-primary:hover {
            background: #9dff44;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(124, 252, 0, 0.4);
        }
        
        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .btn-secondary:hover {
            background: rgba(255,255,255,0.2);
            border-color: var(--primary-color);
        }
        
        .btn-icon {
            width: 44px;
            height: 44px;
            padding: 0;
            border-radius: 50%;
        }
        
        /* Episodes Section */
        .episodes-section {
            background: var(--background-light);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .section-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .season-select {
            padding: 10px 15px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }
        
        .episodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        
        .episode-card {
            display: flex;
            gap: 15px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .episode-card:hover,
        .episode-card.active {
            border-color: var(--primary-color);
            background: rgba(124, 252, 0, 0.05);
        }
        
        .episode-thumb {
            width: 120px;
            height: 70px;
            border-radius: 8px;
            background: #333;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }
        
        .episode-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .episode-play-icon {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .episode-card:hover .episode-play-icon {
            opacity: 1;
        }
        
        .episode-info {
            flex: 1;
            min-width: 0;
        }
        
        .episode-number {
            font-size: 12px;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .episode-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .episode-duration {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Related Content */
        .related-section {
            margin-bottom: 30px;
        }
        
        .related-section .section-title {
            margin-bottom: 20px;
        }
        
        .related-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .movie-card {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            background: var(--background-light);
            transition: transform 0.3s ease;
            text-decoration: none;
            color: inherit;
        }
        
        .movie-card:hover {
            transform: translateY(-5px);
        }
        
        .movie-card-poster {
            position: relative;
            aspect-ratio: 2/3;
            overflow: hidden;
        }
        
        .movie-card-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .movie-card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent 50%);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .movie-card:hover .movie-card-overlay {
            opacity: 1;
        }
        
        .play-circle {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
        }
        
        .movie-card-badge {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 8px;
            background: var(--primary-color);
            color: #000;
            font-size: 11px;
            font-weight: 700;
            border-radius: 4px;
        }
        
        .movie-card-info {
            padding: 12px;
        }
        
        .movie-card-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .movie-card-vj {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        /* Footer */
        .player-footer {
            background: var(--background-light);
            padding: 30px 20px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* Loading State */
        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(124, 252, 0, 0.3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Error State */
        .error-state {
            position: absolute;
            inset: 0;
            background: #1a1a1a;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        .error-icon {
            width: 60px;
            height: 60px;
            margin-bottom: 20px;
            color: #ff6b6b;
        }
        
        .error-message {
            font-size: 16px;
            margin-bottom: 20px;
        }
        
        /* ===============================
           RESPONSIVE BREAKPOINTS
           =============================== */
        
        /* Large Desktop */
        @media (min-width: 1400px) {
            .content-wrapper {
                max-width: 1600px;
            }
            
            .related-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            }
        }
        
        /* Desktop */
        @media (min-width: 992px) {
            .movie-poster-small {
                display: block;
            }
            
            .player-wrapper {
                max-width: calc(100% - 40px);
                margin: 0 auto;
                padding-top: 80px;
            }
            
            .plyr {
                border-radius: var(--player-radius);
            }
            
            .action-btn:not(.btn-icon) {
                padding: 14px 24px;
            }
        }
        
        /* Tablet */
        @media (min-width: 768px) and (max-width: 991px) {
            .player-wrapper {
                padding-top: 70px;
            }
            
            .movie-header {
                flex-direction: row;
            }
            
            .movie-poster-small {
                display: block;
                width: 100px;
                height: 150px;
            }
            
            .episodes-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .related-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* Mobile Landscape */
        @media (max-width: 767px) and (orientation: landscape) {
            .player-wrapper {
                height: 100vh;
                padding-top: 0;
            }
            
            .player-header {
                padding: 10px 15px;
                background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            }
            
            .content-wrapper {
                display: none;
            }
            
            .player-footer {
                display: none;
            }
        }
        
        /* Mobile Portrait */
        @media (max-width: 767px) {
            .player-header {
                padding: 10px 15px;
            }
            
            .back-btn span {
                display: none;
            }
            
            .back-btn {
                padding: 10px;
            }
            
            .header-logo {
                height: 28px;
            }
            
            .player-wrapper {
                padding-top: 55px;
            }
            
            .plyr {
                border-radius: 0;
            }
            
            .content-wrapper {
                padding: 15px;
            }
            
            .movie-info-card {
                padding: 20px 15px;
                border-radius: 12px;
            }
            
            .movie-header {
                flex-direction: column;
            }
            
            .movie-title {
                font-size: 22px;
            }
            
            .meta-badge {
                padding: 5px 10px;
                font-size: 12px;
            }
            
            .vj-info {
                padding: 10px 12px;
            }
            
            .vj-avatar {
                width: 40px;
                height: 40px;
            }
            
            .action-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
            
            .action-btn {
                padding: 12px 15px;
                font-size: 13px;
                justify-content: center;
            }
            
            .action-btn.btn-full {
                grid-column: 1 / -1;
            }
            
            .episodes-section {
                padding: 15px;
                border-radius: 12px;
            }
            
            .section-title {
                font-size: 18px;
            }
            
            .episodes-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .episode-card {
                padding: 12px;
            }
            
            .episode-thumb {
                width: 100px;
                height: 60px;
            }
            
            .related-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }
            
            .movie-card-info {
                padding: 10px;
            }
            
            .movie-card-title {
                font-size: 13px;
            }
        }
        
        /* Small Mobile */
        @media (max-width: 374px) {
            .movie-title {
                font-size: 20px;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
            
            .related-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }
        }
        
        /* Touch Device Optimizations */
        @media (hover: none) and (pointer: coarse) {
            .movie-card:hover {
                transform: none;
            }
            
            .movie-card:active {
                transform: scale(0.98);
            }
            
            .movie-card-overlay {
                opacity: 1;
                background: linear-gradient(to top, rgba(0,0,0,0.7), transparent 70%);
            }
            
            .play-circle {
                width: 40px;
                height: 40px;
            }
            
            .episode-play-icon {
                opacity: 1;
            }
        }
        
        /* Safe Area for notched devices */
        @supports (padding: max(0px)) {
            .player-header {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
            }
            
            .content-wrapper {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="player-header" id="playerHeader">
        <a href="index.html" class="back-btn">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            <span>Back</span>
        </a>
        
        <a href="index.html">
            <img src="assets/images/logo.png" alt="Unruly Movies" class="header-logo">
        </a>
        
        <div class="header-actions">
            <button class="header-btn share-btn" aria-label="Share">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="18" cy="5" r="3"></circle>
                    <circle cx="6" cy="12" r="3"></circle>
                    <circle cx="18" cy="19" r="3"></circle>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                </svg>
            </button>
        </div>
    </header>

    <!-- Video Player -->
    <div class="player-wrapper" id="playerWrapper">
        <!-- Native Video Player (for direct video files) -->
        <video id="player" playsinline controls crossorigin style="display: none;">
            <source src="" type="video/mp4">
        </video>
        
        <!-- Embed Player Container (for Streamtape, etc.) -->
        <div id="embedContainer" style="display: none; width: 100%; aspect-ratio: 16/9; background: #000;">
            <iframe 
                id="embedPlayer" 
                src="" 
                frameborder="0" 
                allow="autoplay; fullscreen; encrypted-media; picture-in-picture"
                style="width: 100%; height: 100%;">
            </iframe>
        </div>
        
        <div class="loading-overlay" id="loadingOverlay">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Content Section -->
    <div class="content-wrapper">
        <!-- Ad Banner Below Player -->
        <div class="ad-container" style="margin: 20px 0; text-align: center;">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-1904736753681797"
                 data-ad-slot="auto"
                 data-ad-format="rectangle"
                 data-full-width-responsive="true"></ins>
            <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
        </div>

        <!-- Movie Info -->
        <div class="movie-info-card">
            <div class="movie-header">
                <img src="" alt="" class="movie-poster-small" id="moviePoster">
                <div class="movie-details">
                    <h1 class="movie-title" id="movieTitle">Loading...</h1>
                    
                    <div class="movie-meta" id="movieMeta">
                        <span class="meta-badge quality" id="movieQuality">HD</span>
                        <span class="meta-badge rating" id="movieRating">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                            <span>8.5</span>
                        </span>
                        <span class="meta-badge" id="movieYear">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <span>2024</span>
                        </span>
                        <span class="meta-badge" id="movieDuration">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                            <span>2h 15m</span>
                        </span>
                    </div>
                    
                    <div class="vj-info" id="vjInfo">
                        <img src="assets/images/default-avatar.png" alt="VJ" class="vj-avatar" id="vjAvatar">
                        <div class="vj-details">
                            <div class="vj-label">Translated by</div>
                            <div class="vj-name" id="vjName">VJ Junior</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <p class="movie-description collapsed" id="movieDescription">
                Loading description...
            </p>
            <button class="show-more-btn" id="showMoreBtn">Show more</button>
            
            <div class="action-buttons">
                <button class="action-btn btn-primary btn-full" id="watchlistBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Add to Watchlist
                </button>
                <button class="action-btn btn-secondary" id="likeBtn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                    </svg>
                    Like
                </button>
                <button class="action-btn btn-secondary share-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="18" cy="5" r="3"></circle>
                        <circle cx="6" cy="12" r="3"></circle>
                        <circle cx="18" cy="19" r="3"></circle>
                        <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                        <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                    </svg>
                    Share
                </button>
                <button class="action-btn btn-secondary btn-icon" id="downloadBtn" title="Download">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Episodes Section (for TV Series) -->
        <div class="episodes-section" id="episodesSection" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">Episodes</h2>
                <select class="season-select" id="seasonSelect">
                    <option value="1">Season 1</option>
                </select>
            </div>
            <div class="episodes-grid" id="episodesGrid">
                <!-- Episodes will be generated here -->
            </div>
        </div>

        <!-- Related Content -->
        <section class="related-section">
            <h2 class="section-title">You May Also Like</h2>
            
            <!-- Ad Banner in Related Section -->
            <div class="ad-container" style="margin: 15px 0; text-align: center;">
                <ins class="adsbygoogle"
                     style="display:block"
                     data-ad-client="ca-pub-1904736753681797"
                     data-ad-slot="auto"
                     data-ad-format="fluid"
                     data-ad-layout-key="-fb+5w+4e-db+86"></ins>
                <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
            </div>
            
            <div class="related-grid" id="relatedGrid">
                <!-- Related movies will be loaded here -->
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="player-footer">
        <p>&copy; 2025 <strong>Unruly Movies</strong>. Developed by <strong>Nduga Hafizu</strong>.</p>
        <p style="font-size: 12px; margin-top: 5px; opacity: 0.7;">Legitimate Ugandan platform for Luganda VJ translations</p>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="js/config.js"></script>
    <script src="js/social-share.js"></script>
    <script src="js/watchlist-manager.js"></script>
    
    <script>
        // Initialize Plyr
        const video = document.getElementById('player');
        const embedContainer = document.getElementById('embedContainer');
        const embedPlayer = document.getElementById('embedPlayer');
        const loadingOverlay = document.getElementById('loadingOverlay');
        let player = null;
        let isEmbedMode = false;

        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const movieId = urlParams.get('id');
        const streamUrl = urlParams.get('stream');
        const embedUrl = urlParams.get('embed');
        const isSeries = urlParams.has('series');
        const isStation = urlParams.has('station');

        // Initialize Plyr only for native video
        function initPlyr() {
            if (player) return player;
            
            player = new Plyr(video, {
                controls: [
                    'play-large',
                    'rewind',
                    'play',
                    'fast-forward',
                    'progress',
                    'current-time',
                    'duration',
                    'mute',
                    'volume',
                    'captions',
                    'settings',
                    'pip',
                    'airplay',
                    'fullscreen'
                ],
                settings: ['captions', 'quality', 'speed'],
                speed: { selected: 1, options: [0.5, 0.75, 1, 1.25, 1.5, 2] },
                keyboard: { focused: true, global: true },
                tooltips: { controls: true, seek: true },
                seekTime: 10,
                invertTime: false,
                toggleInvert: true,
                displayDuration: true,
                ratio: '16:9'
            });
            
            return player;
        }

        // Load movie data
        async function loadMovieData() {
            try {
                if (movieId) {
                    const apiUrl = typeof API_CONFIG !== 'undefined' 
                        ? API_CONFIG.BASE_URL 
                        : 'https://luganda-translated-movies-production.up.railway.app';
                    
                    const response = await fetch(`${apiUrl}/api/luganda-movies/${movieId}`);
                    const data = await response.json();
                    
                    if (data.status === 'success' && data.data) {
                        const movie = data.data;
                        updateMovieInfo(movie);
                        
                        // Check for embed URL first (Streamtape, etc.)
                        if (movie.video?.embedUrl || movie.video?.streamtapeId) {
                            const embedSrc = movie.video.embedUrl || 
                                `https://streamtape.com/e/${movie.video.streamtapeId}`;
                            loadEmbedVideo(embedSrc);
                        } else {
                            // Fall back to direct video URL
                            loadVideoSource(movie.video?.url || movie.video?.originalVideoPath || movie.streamUrl);
                        }
                        
                        loadRelatedMovies(movie.genres?.[0] || 'action');
                    }
                } else if (embedUrl) {
                    // Direct embed URL from query param
                    loadEmbedVideo(embedUrl);
                    document.getElementById('movieTitle').textContent = urlParams.get('title') || 'Now Playing';
                } else if (streamUrl) {
                    loadVideoSource(streamUrl);
                    document.getElementById('movieTitle').textContent = urlParams.get('movie') || urlParams.get('station') || 'Now Playing';
                    loadingOverlay.style.display = 'none';
                } else {
                    // Demo video for testing
                    loadVideoSource('https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4');
                    document.getElementById('movieTitle').textContent = 'Demo Video - Big Buck Bunny';
                    document.getElementById('movieDescription').textContent = 'Big Buck Bunny is a short computer-animated comedy film featuring animals of the forest. This is a demo video to test the player functionality.';
                    loadingOverlay.style.display = 'none';
                }
            } catch (error) {
                console.error('Error loading movie:', error);
                loadingOverlay.style.display = 'none';
                // Load demo video on error
                loadVideoSource('https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4');
                document.getElementById('movieTitle').textContent = 'Demo Video';
            }
        }

        // Load embed video (Streamtape, etc.)
        function loadEmbedVideo(url) {
            isEmbedMode = true;
            
            // Hide native player, show embed container
            video.style.display = 'none';
            if (player) {
                player.destroy();
                player = null;
            }
            embedContainer.style.display = 'block';
            
            // Set the embed URL
            embedPlayer.src = url;
            
            // Hide loading when iframe loads
            embedPlayer.onload = () => {
                loadingOverlay.style.display = 'none';
            };
            
            // Fallback hide loading after timeout
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 3000);
            
            console.log('ðŸ“º Playing embed video:', url);
        }

        // Convert Streamtape URL to embed URL
        function getStreamtapeEmbedUrl(url) {
            if (!url) return null;
            
            // If already an embed URL, return as is
            if (url.includes('/e/')) return url;
            
            // Extract video ID from various Streamtape URL formats
            // https://streamtape.com/v/VIDEOID/title
            // https://streamtape.to/v/VIDEOID/title
            const match = url.match(/streamtape\.(com|to|net)\/v\/([a-zA-Z0-9]+)/);
            if (match) {
                return `https://streamtape.com/e/${match[2]}`;
            }
            
            return url;
        }

        // Update movie information on page
        function updateMovieInfo(movie) {
            document.getElementById('movieTitle').textContent = movie.originalTitle || movie.title;
            document.getElementById('movieDescription').textContent = movie.plot || movie.description || 'No description available.';
            
            const poster = document.getElementById('moviePoster');
            poster.src = movie.poster || 'assets/images/placeholder-poster.jpg';
            poster.alt = movie.originalTitle || movie.title;
            
            // Update meta tags for sharing
            document.querySelector('meta[property="og:title"]').content = movie.originalTitle || movie.title;
            document.querySelector('meta[property="og:description"]').content = movie.plot || movie.description || '';
            document.querySelector('meta[property="og:image"]').content = movie.poster || '';
            document.querySelector('meta[property="og:url"]').content = window.location.href;
            document.title = `${movie.originalTitle || movie.title} - Unruly Movies`;
            
            // Update badges
            if (movie.rating?.translationRating) {
                document.getElementById('movieRating').querySelector('span:last-child').textContent = movie.rating.translationRating.toFixed(1);
            }
            if (movie.releaseYear) {
                document.getElementById('movieYear').querySelector('span:last-child').textContent = movie.releaseYear;
            }
            if (movie.video?.quality) {
                document.getElementById('movieQuality').textContent = movie.video.quality.toUpperCase();
            }
            if (movie.video?.duration) {
                document.getElementById('movieDuration').querySelector('span:last-child').textContent = movie.video.duration;
            }
            
            // Update VJ info
            if (movie.vjName) {
                document.getElementById('vjName').textContent = `VJ ${movie.vjName}`;
            }
            if (movie.vjAvatar) {
                document.getElementById('vjAvatar').src = movie.vjAvatar;
            }
            
            // Show episodes section for series
            if (movie.type === 'series' || isSeries) {
                loadEpisodes(movie);
            }
        }

        // Load video source
        function loadVideoSource(url) {
            if (!url) {
                loadingOverlay.style.display = 'none';
                return;
            }
            
            // Check if it's a Streamtape or other embed URL
            if (url.includes('streamtape.') || url.includes('doodstream.') || 
                url.includes('filemoon.') || url.includes('/e/') || url.includes('/embed/')) {
                const embedSrc = getStreamtapeEmbedUrl(url);
                loadEmbedVideo(embedSrc);
                return;
            }
            
            isEmbedMode = false;
            
            // Show native player, hide embed
            video.style.display = 'block';
            embedContainer.style.display = 'none';
            
            // Initialize Plyr
            initPlyr();
            
            // Check if HLS stream
            if (url.includes('.m3u8')) {
                if (Hls.isSupported()) {
                    const hls = new Hls({
                        enableWorker: true,
                        lowLatencyMode: true
                    });
                    
                    hls.loadSource(url);
                    hls.attachMedia(video);
                    
                    hls.on(Hls.Events.MANIFEST_PARSED, () => {
                        loadingOverlay.style.display = 'none';
                    });
                    
                    hls.on(Hls.Events.ERROR, (event, data) => {
                        if (data.fatal) {
                            loadingOverlay.style.display = 'none';
                            console.error('HLS Error:', data);
                        }
                    });
                    
                    window.hlsPlayer = hls;
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = url;
                    video.addEventListener('loadedmetadata', () => {
                        loadingOverlay.style.display = 'none';
                    });
                }
            } else {
                // Regular video file
                video.src = url;
                video.addEventListener('loadedmetadata', () => {
                    loadingOverlay.style.display = 'none';
                });
                video.addEventListener('error', () => {
                    loadingOverlay.style.display = 'none';
                    console.error('Video load error');
                });
            }
        }

        // Load episodes for series
        function loadEpisodes(movie) {
            const episodesSection = document.getElementById('episodesSection');
            const episodesGrid = document.getElementById('episodesGrid');
            
            episodesSection.style.display = 'block';
            episodesGrid.innerHTML = '';
            
            const episodes = movie.episodes || [];
            const numEpisodes = episodes.length || 10;
            
            for (let i = 0; i < numEpisodes; i++) {
                const ep = episodes[i] || {};
                const card = document.createElement('div');
                card.className = `episode-card ${i === 0 ? 'active' : ''}`;
                card.innerHTML = `
                    <div class="episode-thumb">
                        <img src="${ep.thumbnail || movie.poster || 'assets/images/placeholder-episode.jpg'}" alt="Episode ${i + 1}">
                        <div class="episode-play-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                        </div>
                    </div>
                    <div class="episode-info">
                        <div class="episode-number">Episode ${i + 1}</div>
                        <div class="episode-title">${ep.title || `Episode ${i + 1}`}</div>
                        <div class="episode-duration">${ep.duration || '45 min'}</div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    document.querySelectorAll('.episode-card').forEach(c => c.classList.remove('active'));
                    card.classList.add('active');
                    if (ep.url) {
                        loadVideoSource(ep.url);
                    }
                });
                
                episodesGrid.appendChild(card);
            }
        }

        // Load related movies
        async function loadRelatedMovies(genre) {
            const grid = document.getElementById('relatedGrid');
            
            try {
                const apiUrl = typeof API_CONFIG !== 'undefined' 
                    ? API_CONFIG.API_URL 
                    : 'https://luganda-translated-movies-production.up.railway.app';
                
                const response = await fetch(`${apiUrl}/api/luganda-movies?limit=8`);
                const data = await response.json();
                
                if (data.status === 'success' && data.data) {
                    grid.innerHTML = data.data.map(movie => `
                        <a href="player.html?id=${movie._id}" class="movie-card">
                            <div class="movie-card-poster">
                                <img src="${movie.poster || 'assets/images/placeholder-poster.jpg'}" alt="${movie.originalTitle}" loading="lazy">
                                <div class="movie-card-overlay">
                                    <div class="play-circle">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                        </svg>
                                    </div>
                                </div>
                                <span class="movie-card-badge">${movie.video?.quality?.toUpperCase() || 'HD'}</span>
                            </div>
                            <div class="movie-card-info">
                                <div class="movie-card-title">${movie.originalTitle}</div>
                                <div class="movie-card-vj">VJ ${movie.vjName || 'Unknown'}</div>
                            </div>
                        </a>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading related movies:', error);
                grid.innerHTML = '<p style="color: #888; text-align: center; grid-column: 1/-1;">Unable to load recommendations</p>';
            }
        }

        // Show more / Show less description
        const showMoreBtn = document.getElementById('showMoreBtn');
        const description = document.getElementById('movieDescription');
        
        showMoreBtn.addEventListener('click', () => {
            description.classList.toggle('collapsed');
            showMoreBtn.textContent = description.classList.contains('collapsed') ? 'Show more' : 'Show less';
        });

        // Header hide on scroll
        let lastScroll = 0;
        const header = document.getElementById('playerHeader');
        
        window.addEventListener('scroll', () => {
            const currentScroll = window.pageYOffset;
            
            if (currentScroll > lastScroll && currentScroll > 100) {
                header.classList.add('hidden');
            } else {
                header.classList.remove('hidden');
            }
            
            lastScroll = currentScroll;
        });

        // Watchlist button
        const watchlistBtn = document.getElementById('watchlistBtn');
        watchlistBtn.addEventListener('click', () => {
            if (typeof WatchlistManager !== 'undefined') {
                const movieData = {
                    id: movieId,
                    title: document.getElementById('movieTitle').textContent,
                    poster: document.getElementById('moviePoster').src
                };
                WatchlistManager.toggleWatchlist(movieData);
                
                const isInList = WatchlistManager.isInWatchlist(movieId);
                watchlistBtn.innerHTML = isInList ? `
                    <svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    In Watchlist
                ` : `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"></path>
                    </svg>
                    Add to Watchlist
                `;
            }
        });

        // Initialize
        loadMovieData();

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(err => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>
